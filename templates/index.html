  <!DOCTYPE html>
  <html lang="ru">
  <head>
    <meta charset="UTF-8">
    <title>Crypto Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 text-gray-900">

  <header class="bg-white shadow p-4 mb-4 flex justify-between items-center">
    <div>
      <span class="font-semibold">–ü—Ä–∏–≤–µ—Ç, {{ user.login }}</span>
      <span class="text-gray-500 text-sm"> ({{ user.role }})</span>
    </div>
    <div class="flex items-center gap-3">
    {% if user.role == "admin" %}
      <a href="{{ url_for('users_list') }}" class="bg-blue-500 text-white px-3 py-1 rounded">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
      <a href="javascript:void(0)" onclick="document.getElementById('categoriesModal').classList.remove('hidden')"
   class="bg-indigo-500 text-white px-3 py-1 rounded">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>

      <form method="get" class="inline">
        <select name="service_id" onchange="this.form.submit()" class="border px-2 py-1 rounded">
          <option value="">–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã</option>
          {% for s in services %}
            <option value="{{ s.id }}" {% if selected_service_id == s.id %}selected{% endif %}>
              {{ s.name }}
            </option>
          {% endfor %}
        </select>
      </form>
    {% endif %}

    <!-- ‚úÖ –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏ –∞–¥–º–∏–Ω—É, –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É -->
    <button type="button"
            onclick="document.getElementById('adminIOModal').classList.remove('hidden')"
            class="bg-purple-600 text-white px-3 py-1 rounded">üí∞ –í–Ω–µ—Å—Ç–∏/–í—ã–≤–µ—Å—Ç–∏</button>
            <button type="button"
        onclick="document.getElementById('addAssetModal').classList.remove('hidden')"
        class="bg-indigo-600 text-white px-3 py-1 rounded">
  ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤
</button>

    <a href="{{ url_for('logout') }}" class="bg-red-500 text-white px-3 py-1 rounded">–í—ã–π—Ç–∏</a>
  </div>
  </header>

  <div class="container mx-auto px-4">


  

    <!-- –ë–∞–ª–∞–Ω—Å—ã -->
<div id="balances" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3 mb-4">
  {% for balance, asset in balances %}
    {% if asset.id in top_assets %}
      <div class="p-2 rounded-lg shadow-sm flex flex-col items-center justify-center text-center border 
                  transition hover:shadow-md bg-white">
        
        <!-- –ò–∫–æ–Ω–∫–∞ -->
        <!-- –ò–∫–æ–Ω–∫–∞ + –ù–∞–∑–≤–∞–Ω–∏–µ -->
<div class="flex items-center justify-center gap-2 mb-1">
  <div class="w-7 h-7 flex items-center justify-center bg-gray-100 rounded-full">
    {% if ICON_MAP.get(asset.symbol) %}
      <img src="{{ ICON_MAP[asset.symbol] }}" alt="{{ asset.symbol }}" class="w-4 h-4"
     onerror="this.outerHTML='<span class=\'text-sm\'>üîπ</span>'">
    {% else %}
      <span class="text-sm">üîπ</span>
    {% endif %}
  </div>
  <div class="text-[12px] font-semibold text-gray-800">
    {{ NAME_MAP.get(asset.symbol, asset.symbol) }}
  </div>
</div>

<!-- –ë–∞–ª–∞–Ω—Å -->
<div class="text-base font-bold text-gray-900 tracking-tight">
  {{ balance.amount|trim_float }} {{ ALIAS.get(asset.symbol, asset.symbol) }}
</div>



        <!-- –ö–Ω–æ–ø–∫–∞ -->
        {% if user.role == "admin" %}
          <button type="button"
                  onclick="openSetBalanceModal({{ asset.id }}, '{{ asset.symbol }}', {{ balance.amount }})"
                  class="mt-1 bg-gray-200 text-gray-700 px-2 py-0.5 rounded text-[10px] hover:bg-gray-300">
            ‚úèÔ∏è
          </button>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
</div>




<div class="flex justify-between items-center mb-2">
  <h2 class="text-lg font-semibold">–ê–∫—Ç–∏–≤—ã</h2>
  <button onclick="document.getElementById('editAssetsModal').classList.remove('hidden')"
          class="bg-blue-600 text-white px-3 py-1 rounded">
    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
  </button>
</div>

<!-- —Å–∫—Ä—ã—Ç—ã–µ –∞–∫—Ç–∏–≤—ã -->
<div id="more-balances" class="hidden grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 mb-4">
  {% for balance, asset in balances %}
    {% if asset.id not in top_assets %}
      <div class="bg-white p-2 rounded shadow flex flex-col items-center text-xs">
        <div class="text-lg">
          {% if asset.symbol == "BTC" %} ‚Çø
          {% elif "USDT" in asset.symbol %} üíµ
          {% elif asset.symbol == "RUB" %} ‚ÇΩ
          {% else %} üîπ
          {% endif %}
        </div>
        <div class="font-medium text-[10px] text-center truncate w-full">{{ asset.symbol }}</div>
        <div class="text-gray-600 text-xs w-full text-center break-all">
  {{ balance.amount|trim_float }}
</div>

        {% if user.role == "admin" %}
          <button type="button"
                  onclick="openSetBalanceModal({{ asset.id }}, '{{ asset.symbol }}', {{ balance.amount }})"
                  class="bg-orange-500 text-white px-2 py-0.5 mt-1 rounded text-[10px]">
            ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
          </button>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
</div>

<!-- –∫–Ω–æ–ø–∫–∞ -->
<button onclick="document.getElementById('more-balances').classList.toggle('hidden')"
        class="bg-gray-200 px-3 py-1 rounded text-sm">
  –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å / –°–∫—Ä—ã—Ç—å
</button>

 <!-- –ü–∞–Ω–µ–ª—å —Å–º–µ–Ω -->
<div class="bg-white p-4 rounded shadow mb-6 w-full">
  <h2 class="text-lg font-semibold mb-3">–ê–∫—Ç–∏–≤–Ω–∞—è —Å–º–µ–Ω–∞</h2>

  {% if current_shift %}
    <div class="flex justify-between items-start text-sm">
      <div>
        <p><b>–°–º–µ–Ω–∞ ‚Ññ:</b> {{ current_shift.number }}</p>
        <p><b>–ó–∞–ø—É—Å—Ç–∏–ª:</b> {{ current_shift.user.login if current_shift.user else '-' }}</p>
        <p><b>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</b>
          {{ current_shift.start_time.strftime("%d.%m.%Y %H:%M") if current_shift.start_time else '-' }}
        </p>
      </div>
      <div class="text-right">
        <p class="font-semibold text-green-600">
          –ü—Ä–∏–±—ã–ª—å —Ç–µ–∫—É—â–µ–π —Å–º–µ–Ω—ã: {{ "%.2f"|format(current_profit) }} ‚ÇΩ
        </p>
        <p class="text-gray-600 text-sm">
          –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å–º–µ–Ω–∞: {{ "%.2f"|format(prev_profit) }} ‚ÇΩ
        </p>
      </div>
    </div>
  {% else %}
    <p class="text-gray-600">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã</p>
  {% endif %}

  <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–º–µ–Ω -->
  <div class="flex gap-3 mt-4">
    {% for i in range(1,4) %}
      <form action="{{ url_for('set_shift') }}" method="post" class="shift-form">
        <input type="hidden" name="shift_number" value="{{ i }}">
        <button type="button"
          onclick="openShiftModal({{ i }}, this.form)"
          class="px-4 py-1.5 rounded 
                 {{ 'bg-green-500 text-white' if current_shift and current_shift.number == i else 'bg-gray-200' }}">
          –°–º–µ–Ω–∞ {{ i }}
        </button>
      </form>
    {% endfor %}
  </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="bg-white p-3 rounded shadow flex justify-between items-center mb-4">
  <form method="get" class="flex gap-2 items-center text-sm">
    <select name="category_id" class="border px-2 py-1 rounded text-sm">
      <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
      {% for cat in categories %}
        <option value="{{ cat.id }}" {% if request.args.get('category_id') == cat.id|string %}selected{% endif %}>
          {{ cat.name }}
        </option>
      {% endfor %}
    </select>

    <select name="asset_id" class="border px-2 py-1 rounded text-sm">
      <option value="">–í—Å–µ –∞–∫—Ç–∏–≤—ã</option>
      {% for asset in assets %}
        <option value="{{ asset.id }}" {% if request.args.get('asset_id') == asset.id|string %}selected{% endif %}>
          {{ asset.symbol }}
        </option>
      {% endfor %}
    </select>

    <select name="operator_id" class="border px-2 py-1 rounded text-sm">
      <option value="">–í—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã</option>
      {% for u in all_users %}
        <option value="{{ u.id }}" {% if request.args.get('operator_id') == u.id|string %}selected{% endif %}>
          {{ u.login }}
        </option>
      {% endfor %}
    </select>

    <input type="text" name="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." 
           value="{{ request.args.get('comment','') }}"
           class="border px-2 py-1 rounded text-sm">

    <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">
      –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å
    </button>
  </form>

  <div class="flex gap-2 items-center text-sm">
    {% if current_shift %}
      <a href="{{ url_for('index', my_shift=1, service_id=selected_service_id) }}"
         class="bg-purple-600 text-white px-3 py-1 rounded text-sm">
        üìã –ú–æ—è —Å–º–µ–Ω–∞
      </a>
    {% endif %}

    <a href="{{ url_for('index', service_id=selected_service_id) }}"
       class="bg-gray-300 text-black px-3 py-1 rounded text-sm">
      üîÑ –í—Å–µ
    </a>

    <button onclick="document.getElementById('transferModal').classList.remove('hidden')"
            class="bg-green-600 text-white px-3 py-1 rounded text-sm">
      –ü–µ—Ä–µ–≤–æ–¥
    </button>

    {% if user.role == "operator" %}
      <button onclick="document.getElementById('orderModal').classList.remove('hidden')"
              class="bg-blue-600 text-white px-3 py-1 rounded text-sm">
        ‚ûï –û–±–º–µ–Ω
      </button>
    {% endif %}
  </div>
</div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ -->
    <div class="bg-white p-3 rounded shadow">
    <table class="w-full text-sm border-collapse">
      <thead>
  <tr class="bg-gray-100">
    <th class="p-2 border">ID</th>
    <th class="p-2 border">–í—Ä–µ–º—è</th>
    <th class="p-2 border">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th> <!-- üîπ –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <th class="p-2 border">–û–ø–µ—Ä–∞—Ç–æ—Ä</th>
    <th class="p-2 border">–ü–æ–ª—É—á–∏–ª–∏</th>
    <th class="p-2 border">–û—Ç–¥–∞–ª–∏</th>
    <th class="p-2 border">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
    <th class="p-2 border">–ü—Ä–∏–±—ã–ª—å (%)</th>
    <th class="p-2 border">–ü—Ä–∏–±—ã–ª—å (‚ÇΩ)</th>
    <th class="p-2 border">–î–µ–π—Å—Ç–≤–∏—è</th>
  </tr>
</thead>
  <tbody>
  {% for o in orders %}
  <tr class="{% if o.is_deleted %}bg-red-100 line-through{% endif %}">
    <td class="p-2 border">{{ o.id }}</td>
    <td class="p-2 border">
      {{ o.created_at|to_moscow }}
    </td>
    <td class="p-2 border">
      {{ o.category.name if o.category else '-' }}
    </td>
    <td class="p-2 border">{{ o.user.login if o.user else '-' }}</td>
    <td class="p-2 border text-green-600">
      {{ o.received_amount|trim_float }} {{ o.received_asset.symbol if o.received_asset else '' }}
    </td>
    <td class="p-2 border text-red-600">
      {{ o.given_amount|trim_float }} {{ o.given_asset.symbol if o.given_asset else '' }}
    </td>
    <td class="p-2 border">{{ o.comment }}</td>
    <td class="p-2 border">{{ "%.2f"|format(o.profit_percent or 0) }} %</td>
    <td class="p-2 border">{{ "%.2f"|format(o.profit_rub or 0) }} ‚ÇΩ</td>
    <td class="p-2 border">
  {% if not o.is_deleted %}
    {% if current_shift and o.shift_id == current_shift.id and o.user_id == user.id %}
      <!-- –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
      <button type="button"
              onclick="openEditOrderModal(
                {{ o.id }},
                '{{ o.comment or "" }}',
                {{ o.received_amount or 0 }},
                {{ o.given_amount or 0 }},
                {{ o.received_asset_id or 'null' }},
                {{ o.given_asset_id or 'null' }},
                {{ o.category_id or 'null' }}
              )"
              class="bg-yellow-500 text-white px-2 py-1 rounded text-xs">
        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
      </button>

      <!-- –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
      <form action="{{ url_for('delete_order', order_id=o.id) }}" method="post" style="display:inline;">
        <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded text-xs">–£–¥–∞–ª–∏—Ç—å</button>
      </form>
      
    {% endif %}

    {# --- –µ—Å–ª–∏ —ç—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –í–Ω–µ—Å—Ç–∏/–í—ã–≤–µ—Å—Ç–∏ --- #}
    {% if o.type == "admin_io" and o.user_id == user.id %}
      <button type="button"
              onclick="openEditIOmodal({{ o.id }}, '{{ o.comment or "" }}', {{ o.amount or 0 }}, {{ o.asset_id or 'null' }}, '{{ o.direction }}')"
              class="bg-yellow-500 text-white px-2 py-1 rounded text-xs">
        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
      </button>

      <form action="{{ url_for('delete_io', io_id=o.id) }}" method="post" style="display:inline;">
        <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded text-xs">–£–¥–∞–ª–∏—Ç—å</button>
      </form>
    {% endif %}


  {% else %}
    <span class="text-red-600 text-xs">–£–¥–∞–ª—ë–Ω</span>
  {% endif %}
</td>
  </tr>
{% endfor %}
</tbody>
    </table>


  </div>

 {% set args = request.args.to_dict(flat=True) %}
{% set _ = args.pop('page', None) %}
{% set _ = args.pop('per_page', None) %}

  <!-- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
  <div class="flex justify-between items-center mt-4">

  <!-- üîπ –í–≤–æ–¥ per_page -->
  <form method="get" class="flex items-center gap-2 text-sm">
    {% for k,v in args.items() %}
      <input type="hidden" name="{{ k }}" value="{{ v }}">
    {% endfor %}
    <label>–°—Ç—Ä–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É:</label>
    <input type="number" name="per_page" value="{{ per_page }}" min="5" max="200"
           class="border px-2 py-1 rounded w-20 text-sm"
           onchange="this.form.submit()">
  </form>

  <!-- üîπ –ù—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü -->
  <div class="flex gap-1">
    {% if page > 1 %}
      <a href="{{ url_for('index', page=page-1, per_page=per_page, **args) }}"
         class="px-2 py-1 border rounded">¬´</a>
    {% endif %}

    {% for p in range(1, total_pages+1) %}
      {% if p == page %}
        <span class="px-2 py-1 border rounded bg-blue-500 text-white">{{ p }}</span>
      {% elif p >= page-2 and p <= page+2 %}
        <a href="{{ url_for('index', page=p, per_page=per_page, **args) }}"
           class="px-2 py-1 border rounded">{{ p }}</a>
      {% elif p == 1 or p == total_pages %}
        <a href="{{ url_for('index', page=p, per_page=per_page, **args) }}"
           class="px-2 py-1 border rounded">{{ p }}</a>
        {% if p == 1 and page > 4 %}<span class="px-2">...</span>{% endif %}
        {% if p == total_pages and page < total_pages-3 %}<span class="px-2">...</span>{% endif %}
      {% endif %}
    {% endfor %}

    {% if page < total_pages %}
      <a href="{{ url_for('index', page=page+1, per_page=per_page, **args) }}"
         class="px-2 py-1 border rounded">¬ª</a>
    {% endif %}
  </div>

  <!-- üîπ –ü–æ–∫–∞–∑–∞–Ω–æ N –∏–∑ M -->
  <div class="text-sm text-gray-600">
    –ü–æ–∫–∞–∑–∞–Ω–æ {{ orders|length }} –∏–∑ {{ total_orders }}
  </div>
</div>

  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ -->
  <div id="transferModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow w-96">
      <h2 class="text-lg font-bold mb-3">–ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏</h2>
      <form action="{{ url_for('internal_transfer') }}" method="post" class="space-y-3">
        <div>
          <label class="block text-sm">–û—Ç–∫—É–¥–∞</label>
          <select name="from_service_id" class="border w-full px-2 py-1 rounded">
            {% for s in services %}
              <option value="{{ s.id }}">{{ s.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm">–ö—É–¥–∞</label>
          <select name="to_service_id" class="border w-full px-2 py-1 rounded">
            {% for s in services %}
              <option value="{{ s.id }}">{{ s.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm">–ê–∫—Ç–∏–≤</label>
          <select name="asset_id" class="border w-full px-2 py-1 rounded">
            {% for asset in assets %}
              <option value="{{ asset.id }}">{{ asset.symbol }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm">–°—É–º–º–∞</label>
          <input type="number" step="any" name="amount" class="border w-full px-2 py-1 rounded">
        </div>
        <div>
          <label class="block text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
          <input type="text" name="comment" class="border w-full px-2 py-1 rounded">
        </div>
        <div>
        <label class="block text-sm">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select name="category_id" class="border w-full px-2 py-1 rounded">
          <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          {% for cat in categories %}
            <option value="{{ cat.id }}">{{ cat.name }}</option>
          {% endfor %}
        </select>
      </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="document.getElementById('transferModal').classList.add('hidden')"
                  class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞: –î–æ–±–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É -->
  <div id="orderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow w-96">
      <h2 class="text-lg font-bold mb-3">–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</h2>
      <form action="{{ url_for('add_order') }}" method="post" class="space-y-3">
        
        <!-- –ü–æ–ª—É—á–∞–µ–º -->
        <div>
          <label class="block text-sm">–ü–æ–ª—É—á–∞–µ–º (–ê–∫—Ç–∏–≤)</label>
          <select name="received_asset_id" class="border w-full px-2 py-1 rounded">
            {% for asset in assets %}
              <option value="{{ asset.id }}">{{ asset.symbol }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm">–°—É–º–º–∞ –ø–æ–ª—É—á–∞–µ–º</label>
          <input type="number" step="any" name="received_amount" class="border w-full px-2 py-1 rounded" required>
        </div>

        <!-- –û—Ç–¥–∞—ë–º -->
        <div>
          <label class="block text-sm">–û—Ç–¥–∞—ë–º (–ê–∫—Ç–∏–≤)</label>
          <select name="given_asset_id" class="border w-full px-2 py-1 rounded">
            {% for asset in assets %}
              <option value="{{ asset.id }}">{{ asset.symbol }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm">–°—É–º–º–∞ –æ—Ç–¥–∞—ë–º</label>
          <input type="number" step="any" name="given_amount" class="border w-full px-2 py-1 rounded" required>
        </div>

        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
        <div>
          <label class="block text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
          <input type="text" name="comment" class="border w-full px-2 py-1 rounded">
        </div>

        <div>
          <label class="block text-sm">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select name="category_id" class="border w-full px-2 py-1 rounded">
            <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {% for cat in categories %}
              <option value="{{ cat.id }}">{{ cat.name }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="flex justify-end gap-2">
          <button type="button" onclick="document.getElementById('orderModal').classList.add('hidden')"
                  class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <div id="adminIOModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow w-96">
      <h2 class="text-lg font-bold mb-3">–ê–¥–º–∏–Ω: –í–Ω–µ—Å—Ç–∏ / –í—ã–≤–µ—Å—Ç–∏ –∞–∫—Ç–∏–≤</h2>
      <form action="{{ url_for('admin_io') }}" method="post" class="space-y-3">
        <div>
          <label class="block text-sm">–°–µ—Ä–≤–∏—Å</label>
          <select name="service_id" class="border w-full px-2 py-1 rounded">
            {% for s in services %}
              <option value="{{ s.id }}">{{ s.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm">–ê–∫—Ç–∏–≤</label>
          <select name="asset_id" class="border w-full px-2 py-1 rounded">
            {% for asset in assets %}
              <option value="{{ asset.id }}">{{ asset.symbol }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
          <select name="direction" class="border w-full px-2 py-1 rounded">
            <option value="in">–í–Ω–µ—Å—Ç–∏</option>
            <option value="out">–í—ã–≤–µ—Å—Ç–∏</option>
          </select>
        </div>
        <div>
          <label class="block text-sm">–°—É–º–º–∞</label>
          <input type="number" step="any" name="amount" required class="border w-full px-2 py-1 rounded">
        </div>
        <div>
          <label class="block text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
          <input type="text" name="comment" class="border w-full px-2 py-1 rounded">
        </div>
        
        <!-- üîπ –ù–æ–≤–æ–µ –ø–æ–ª–µ –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div>
          <label class="block text-sm">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select name="category_id" class="border w-full px-2 py-1 rounded">
            <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {% for cat in categories %}
              <option value="{{ cat.id }}">{{ cat.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" onclick="document.getElementById('adminIOModal').classList.add('hidden')"
                  class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="bg-purple-600 text-white px-3 py-1 rounded">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

<div id="shiftConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-96">
    <h2 class="text-lg font-bold mb-3">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–º–µ–Ω—ã</h2>
    <p id="shiftModalText" class="mb-4 text-gray-700">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</p>
    <div class="flex justify-end gap-2">
      <button type="button" onclick="closeShiftModal()"
              class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
      <button id="shiftConfirmBtn" type="button"
              class="bg-red-600 text-white px-3 py-1 rounded">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </div>
  </div>
</div>

<div id="addAssetModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-96">
    <h2 class="text-lg font-bold mb-3">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–∫—Ç–∏–≤</h2>
    <form action="{{ url_for('add_asset') }}" method="post" class="space-y-3">
      <div>
        <label class="block text-sm">–°–µ—Ä–≤–∏—Å</label>
        <select name="service_id" class="border w-full px-2 py-1 rounded" required>
          {% for s in services %}
            <option value="{{ s.id }}">{{ s.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm">–°–∏–º–≤–æ–ª</label>
        <input type="text" name="symbol" class="border w-full px-2 py-1 rounded" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: USDT TRC-20">
      </div>
      <div>
        <label class="block text-sm">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input type="text" name="name" class="border w-full px-2 py-1 rounded" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Tether TRC-20">
      </div>
      <div>
  <label class="block text-sm">–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ (API)</label>
  <select id="pairSelect" name="pair_symbol" class="border w-full px-2 py-1 rounded">
    <option value="">–ê–≤—Ç–æ (SYMBOLUSDT)</option>
  </select>
</div>

<div>
  <label class="block text-sm">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—É—Ä—Å (‚ÇΩ, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
  <input type="number" step="any" name="manual_rate"
         class="border w-full px-2 py-1 rounded"
         placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1.0 –¥–ª—è RUB">
</div>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('addAssetModal').classList.add('hidden')"
                class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="bg-indigo-600 text-white px-3 py-1 rounded">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>
</div>


<div id="editAssetsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
  <!-- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Å–∫—Ä–æ–ª–ª–∏—Ç—å -->
  <div class="max-h-[90vh] overflow-y-auto bg-white rounded-lg shadow-lg w-[800px] p-6">
    <h2 class="text-xl font-bold mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤</h2>
    <p class="text-sm text-gray-600 mb-4">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞–∫—Ç–∏–≤—ã –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å ¬´–û—Å–Ω–æ–≤–Ω—ã–µ¬ª –∏ ¬´–†–µ–∑–µ—Ä–≤–Ω—ã–µ¬ª.</p>

    <div class="grid grid-cols-2 gap-6">
      <!-- –û—Å–Ω–æ–≤–Ω—ã–µ -->
      <div>
        <h3 class="font-semibold mb-2">–û—Å–Ω–æ–≤–Ω—ã–µ –∞–∫—Ç–∏–≤—ã</h3>
        <ul id="mainAssets" class="min-h-[300px] border rounded p-2 bg-gray-50 space-y-2">
          {% for balance, asset in balances if asset.id in top_assets %}
          <li data-id="{{ asset.id }}" class="cursor-move bg-white shadow rounded px-3 py-2 flex justify-between items-center">
  <span>{{ NAME_MAP.get(asset.symbol, asset.symbol) }}</span>
  <div class="flex gap-2 items-center">
    <div class="text-gray-600 text-xs">{{ balance.amount|trim_float }}</div>

    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–∏—Ç—å -->
    {% if user.role == "admin" %}
  <form action="{{ url_for('delete_asset', asset_id=asset.id) }}" method="post"
        onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∞–∫—Ç–∏–≤ {{ NAME_MAP.get(asset.symbol, asset.symbol) }}?');">
    <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded text-xs">üóë –£–¥–∞–ª–∏—Ç—å</button>
  </form>
{% endif %}
  </div>
</li>
          {% endfor %}
        </ul>
      </div>

      <!-- –†–µ–∑–µ—Ä–≤–Ω—ã–µ -->
      <div>
        <h3 class="font-semibold mb-2">–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∞–∫—Ç–∏–≤—ã</h3>
        <ul id="reserveAssets" class="min-h-[300px] border rounded p-2 bg-gray-50 space-y-2">
          {% for balance, asset in balances if asset.id not in top_assets %}
          <li data-id="{{ asset.id }}" class="cursor-move bg-white shadow rounded px-3 py-2 flex justify-between">
            <span>{{ asset.symbol }}</span>
            <div class="text-gray-600 text-xs w-full text-center break-all">
  {{ balance.amount|trim_float }}
</div>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="flex justify-end gap-3 mt-6">
      <button onclick="document.getElementById('editAssetsModal').classList.add('hidden')"
              class="px-4 py-2 rounded bg-gray-300">–û—Ç–º–µ–Ω–∞</button>
      <button onclick="saveAssets()"
              class="px-4 py-2 rounded bg-blue-600 text-white">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>


<div id="categoriesModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-[500px]">
    <h2 class="text-lg font-bold mb-3">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±–º–µ–Ω–æ–≤</h2>

    <!-- —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <form action="{{ url_for('add_category') }}" method="post" class="flex gap-2 mb-4">
      <input type="text" name="name" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
             class="border px-2 py-1 rounded w-full" required>
      <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <!-- —Ç–∞–±–ª–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <table class="w-full text-sm border-collapse mb-4">
      <thead>
        <tr class="bg-gray-100">
          <th class="p-2 border">ID</th>
          <th class="p-2 border">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th class="p-2 border">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for cat in categories %}
        <tr>
          <td class="p-2 border">{{ cat.id }}</td>
          <td class="p-2 border">{{ cat.name }}</td>
          <td class="p-2 border">
            <form action="{{ url_for('delete_category', category_id=cat.id) }}" method="post" style="display:inline;">
              <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded text-xs">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- –∫–Ω–æ–ø–∫–∏ -->
    <div class="flex justify-end">
      <button type="button" onclick="document.getElementById('categoriesModal').classList.add('hidden')"
              class="bg-gray-300 px-3 py-1 rounded">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<div id="setBalanceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-96">
    <h2 class="text-lg font-bold mb-3">–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞</h2>
    <form action="{{ url_for('admin_set_balance') }}" method="post" class="space-y-3">
      <input type="hidden" name="service_id" value="{{ selected_service_id or user.service_id }}">
      <input type="hidden" id="setBalanceAssetId" name="asset_id">

      <div>
        <label class="block text-sm">–ê–∫—Ç–∏–≤</label>
        <input type="text" id="setBalanceAssetName" disabled class="border w-full px-2 py-1 rounded bg-gray-100">
      </div>

      <div>
        <label class="block text-sm">–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</label>
        <input type="number" step="any" id="setBalanceAmount" name="amount" required class="border w-full px-2 py-1 rounded">
      </div>

      <div>
        <label class="block text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
        <input type="text" name="comment" class="border w-full px-2 py-1 rounded">
      </div>

      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('setBalanceModal').classList.add('hidden')"
                class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="bg-orange-600 text-white px-3 py-1 rounded">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>
</div>


<div id="editOrderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-96">
    <h2 class="text-lg font-bold mb-3">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É</h2>
    <form id="editOrderForm" method="post" class="space-y-3">
      <input type="hidden" name="order_id" id="editOrderId">

      <!-- –ü–æ–ª—É—á–∞–µ–º -->
      <div>
        <label class="block text-sm">–ü–æ–ª—É—á–∞–µ–º (–ê–∫—Ç–∏–≤)</label>
        <select name="received_asset_id" id="editReceivedAsset" class="border w-full px-2 py-1 rounded">
          {% for asset in assets %}
            <option value="{{ asset.id }}">{{ asset.symbol }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm">–°—É–º–º–∞ –ø–æ–ª—É—á–∞–µ–º</label>
        <input type="number" step="any" name="received_amount" id="editReceivedAmount" class="border w-full px-2 py-1 rounded">
      </div>

      <!-- –û—Ç–¥–∞—ë–º -->
      <div>
        <label class="block text-sm">–û—Ç–¥–∞—ë–º (–ê–∫—Ç–∏–≤)</label>
        <select name="given_asset_id" id="editGivenAsset" class="border w-full px-2 py-1 rounded">
          {% for asset in assets %}
            <option value="{{ asset.id }}">{{ asset.symbol }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm">–°—É–º–º–∞ –æ—Ç–¥–∞—ë–º</label>
        <input type="number" step="any" name="given_amount" id="editGivenAmount" class="border w-full px-2 py-1 rounded">
      </div>

      <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
      <div>
        <label class="block text-sm">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select name="category_id" id="editCategory" class="border w-full px-2 py-1 rounded">
          <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          {% for cat in categories %}
            <option value="{{ cat.id }}">{{ cat.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
      <div>
        <label class="block text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
        <input type="text" name="comment" id="editOrderComment" class="border w-full px-2 py-1 rounded">
      </div>

      <!-- –ö–Ω–æ–ø–∫–∏ -->
      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('editOrderModal').classList.add('hidden')"
                class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="bg-yellow-600 text-white px-3 py-1 rounded">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>
</div>



<div id="editIOModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-96">
    <h2 class="text-lg font-bold mb-3">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –í–Ω–µ—Å—Ç–∏/–í—ã–≤–µ—Å—Ç–∏</h2>
    <form id="editIOForm" method="post" class="space-y-3">
      <input type="hidden" name="io_id" id="editIOId">

      <div>
        <label class="block text-sm">–ê–∫—Ç–∏–≤</label>
        <select name="asset_id" id="editIOAsset" class="border w-full px-2 py-1 rounded">
          {% for asset in assets %}
            <option value="{{ asset.id }}">{{ asset.symbol }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="block text-sm">–°—É–º–º–∞</label>
        <input type="number" step="any" name="amount" id="editIOAmount" class="border w-full px-2 py-1 rounded">
      </div>

      <div>
        <label class="block text-sm">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
        <select name="direction" id="editIODirection" class="border w-full px-2 py-1 rounded">
          <option value="in">–í–Ω–µ—Å—Ç–∏</option>
          <option value="out">–í—ã–≤–µ—Å—Ç–∏</option>
        </select>
      </div>

      <div>
        <label class="block text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
        <input type="text" name="comment" id="editIOComment" class="border w-full px-2 py-1 rounded">
      </div>

      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('editIOModal').classList.add('hidden')"
                class="bg-gray-300 px-3 py-1 rounded">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="bg-yellow-600 text-white px-3 py-1 rounded">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
  // === –≤–∞—à –∫–æ–¥ –¥–ª—è —Å–º–µ–Ω ===
  let targetForm = null;

  function openShiftModal(shiftNumber, form) {
    targetForm = form;
    document.getElementById('shiftModalText').innerText =
      `‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ç–µ–∫—É—â—É—é —Å–º–µ–Ω—É –∏ –æ—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É ${shiftNumber}?`;
    document.getElementById('shiftConfirmModal').classList.remove('hidden');
  }

  function closeShiftModal() {
    document.getElementById('shiftConfirmModal').classList.add('hidden');
    targetForm = null;
  }

  document.getElementById('shiftConfirmBtn').addEventListener('click', () => {
    if (targetForm) {
      targetForm.submit();
    }
  });

  // === –Ω–æ–≤—ã–π –∫–æ–¥ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–æ–≤ ===
  new Sortable(document.getElementById('mainAssets'), { group: 'assets', animation: 150 });
  new Sortable(document.getElementById('reserveAssets'), { group: 'assets', animation: 150 });

  function saveAssets() {
    const mainIds = Array.from(document.querySelectorAll('#mainAssets li')).map(li => li.dataset.id);
    fetch("{{ url_for('update_top_assets') }}", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ main_assets: mainIds })
    }).then(r => {
      if (r.ok) {
        location.reload();
      } else {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏");
      }
    });
  }

document.addEventListener("DOMContentLoaded", () => {
  const select = document.getElementById("pairSelect");
  if (!select) return;

  fetch("/api/pairs")
    .then(r => r.json())
    .then(data => {
      select.innerHTML = "<option value=''>–ê–≤—Ç–æ (SYMBOLUSDT)</option>";
      data.slice(0, 500).forEach(symbol => {  // –æ–≥—Ä–∞–Ω–∏—á–∏–º –¥–æ 500
        const opt = document.createElement("option");
        opt.value = symbol;
        opt.textContent = symbol;
        select.appendChild(opt);
      });
    })
    .catch(() => {
      select.innerHTML = "<option value=''>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>";
    });
});

function openSetBalanceModal(assetId, assetName, amount) {
    document.getElementById("setBalanceAssetId").value = assetId;
    document.getElementById("setBalanceAssetName").value = assetName;
    document.getElementById("setBalanceAmount").value = amount;
    document.getElementById("setBalanceModal").classList.remove("hidden");
}

function openEditOrderModal(id, comment, receivedAmount, givenAmount, receivedAssetId, givenAssetId, categoryId) {
  document.getElementById('editOrderId').value = id;
  document.getElementById('editOrderComment').value = comment;
  document.getElementById('editReceivedAmount').value = receivedAmount;
  document.getElementById('editGivenAmount').value = givenAmount;

  // –∞–∫—Ç–∏–≤—ã
  document.getElementById('editReceivedAsset').value = receivedAssetId;
  document.getElementById('editGivenAsset').value = givenAssetId;

  // –∫–∞—Ç–µ–≥–æ—Ä–∏—è
  if (categoryId) {
    document.getElementById('editCategory').value = categoryId;
  } else {
    document.getElementById('editCategory').value = "";
  }

  // —ç–∫—à–µ–Ω
  document.getElementById('editOrderForm').action = "/edit_order/" + id;
  document.getElementById('editOrderModal').classList.remove('hidden');
}


function openEditIOmodal(id, comment, amount, assetId, direction) {
  document.getElementById('editIOId').value = id;
  document.getElementById('editIOComment').value = comment;
  document.getElementById('editIOAmount').value = amount;
  document.getElementById('editIOAsset').value = assetId;
  document.getElementById('editIODirection').value = direction;

  document.getElementById('editIOForm').action = "/edit_io/" + id;
  document.getElementById('editIOModal').classList.remove('hidden');
}


</script>


  </body>
  </html>
