<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Crypto Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

<header class="bg-white shadow p-4 mb-6 flex justify-between items-center">
  <div>
    <span class="font-semibold">–ü—Ä–∏–≤–µ—Ç, {{ user.login }}</span>
    <span class="text-gray-500 text-sm"> ({{ user.role }})</span>
  </div>
  <div class="flex items-center gap-4">
    {% if user.role == "admin" %}
      <form method="get" action="{{ url_for('index') }}">
        <select name="service_id" onchange="this.form.submit()" class="border rounded px-2 py-1">
          {% for s in services %}
            <option value="{{ s.id }}" {% if service and service.id == s.id %}selected{% endif %}>
              {{ s.name }}
            </option>
          {% endfor %}
        </select>
      </form>
    {% else %}
      <span class="text-gray-600">–°–µ—Ä–≤–∏—Å: {{ service.name }}</span>
    {% endif %}
    <a href="{{ url_for('logout') }}" class="bg-red-500 text-white px-3 py-1 rounded">–í—ã–π—Ç–∏</a>
  </div>
</header>
  <div class="container mx-auto p-6">

    <h1 class="text-2xl font-bold mb-6">
      –°–µ—Ä–≤–∏—Å: {{ service.name if service else "–ù–µ—Ç —Å–µ—Ä–≤–∏—Å–∞" }}
    </h1>


    {% if user.role == "admin" %}
<h2 class="section-title mt-8">–ê–¥–º–∏–Ω—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è</h2>
<form action="{{ url_for('admin_action') }}" method="post" class="bg-white p-4 rounded shadow space-y-3">
  <div>
    <label class="block text-sm font-medium">–°–µ—Ä–≤–∏—Å</label>
    <select name="service_id" class="border px-2 py-1 rounded">
      {% for s in services %}
        <option value="{{ s.id }}">{{ s.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium">–ê–∫—Ç–∏–≤</label>
    <select name="asset_id" class="border px-2 py-1 rounded">
      {% for asset in assets %}
        <option value="{{ asset.id }}">{{ asset.symbol }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium">–û–ø–µ—Ä–∞—Ü–∏—è</label>
    <select name="action_type" class="border px-2 py-1 rounded">
      <option value="deposit">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</option>
      <option value="withdraw">–í—ã–≤–æ–¥</option>
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium">–°—É–º–º–∞</label>
    <input type="number" step="0.0001" name="amount" class="border px-2 py-1 rounded" required>
  </div>

  <div>
    <label class="block text-sm font-medium">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
    <input type="text" name="comment" class="border w-full px-2 py-1 rounded">
  </div>

  <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
</form>
{% endif %}

<h2 class="section-title mt-8">–ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏</h2>
<form action="{{ url_for('internal_transfer') }}" method="post" class="bg-white p-4 rounded shadow space-y-3">
  <div>
  <label class="block text-sm font-medium">–û—Ç–∫—É–¥–∞ (—Å–µ—Ä–≤–∏—Å)</label>
  <select name="from_service_id" class="border px-2 py-1 rounded" {% if user.role == 'operator' %} disabled {% endif %}>
    {% for s in services %}
      <option value="{{ s.id }}" {% if user.role == 'operator' and s.id == service.id %} selected {% endif %}>
        {{ s.name }}
      </option>
    {% endfor %}
  </select>
  {% if user.role == 'operator' %}
    <input type="hidden" name="from_service_id" value="{{ service.id }}">
  {% endif %}
</div>

  <div>
  <label class="block text-sm font-medium">–ö—É–¥–∞ (—Å–µ—Ä–≤–∏—Å)</label>
  <select name="to_service_id" class="border px-2 py-1 rounded">
    {% for s in services %}
      <option value="{{ s.id }}">{{ s.name }}</option>
    {% endfor %}
  </select>
</div>

  <div>
    <label class="block text-sm font-medium">–ê–∫—Ç–∏–≤</label>
    <select name="asset_id" class="border px-2 py-1 rounded">
      {% for asset in assets %}
        <option value="{{ asset.id }}">{{ asset.symbol }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium">–°—É–º–º–∞</label>
    <input type="number" step="0.0001" name="amount" class="border px-2 py-1 rounded" required>
  </div>

  <div>
    <label class="block text-sm font-medium">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
    <input type="text" name="comment" class="border w-full px-2 py-1 rounded">
  </div>

  <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
</form>

    <!-- –ë–∞–ª–∞–Ω—Å—ã -->
    <h2 class="section-title">–ë–∞–ª–∞–Ω—Å—ã</h2>
    <table class="custom-table mb-6">
      <thead>
        <tr><th>–ê–∫—Ç–∏–≤</th><th>–°—É–º–º–∞</th></tr>
      </thead>
      <tbody>
        {% for balance, asset in balances %}
        <tr><td>{{ asset.symbol }}</td><td>{{ balance.amount }}</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="flex justify-between items-center mb-4">
  <h2 class="section-title">–ó–∞—è–≤–∫–∏</h2>
  <a href="{{ url_for('shift_report_html') }}" 
     class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
    üìä –û—Ç—á—ë—Ç –ø–æ —Å–º–µ–Ω–µ
  </a>
</div>

    <!-- –ó–∞—è–≤–∫–∏ -->
    <h2 class="section-title">–ó–∞—è–≤–∫–∏</h2>
    <table class="custom-table">
      <thead>
        <tr><th>ID</th><th>–¢–∏–ø</th><th>–ü–æ–ª—É—á–∏–ª–∏</th><th>–û—Ç–¥–∞–ª–∏</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th></tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>{{ o.id }}</td>
          <td>{{ o.type }}</td>
          <td>{{ o.received_amount }}</td>
          <td>{{ o.given_amount }}</td>
          <td>{{ o.comment }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    
    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="pagination">
      {% if page > 1 %}
        <a href="{{ url_for('index', page=page-1) }}" class="page-btn">‚¨Ö –ù–∞–∑–∞–¥</a>
      {% endif %}
      <span class="page-current">–°—Ç—Ä. {{ page }}</span>
      {% if has_next %}
        <a href="{{ url_for('index', page=page+1) }}" class="page-btn">–í–ø–µ—Ä—ë–¥ ‚û°</a>
      {% endif %}
    </div>

    <!-- –°–û–ó–î–ê–ù–ò–ï –ó–ê–Ø–í–ö–ò -->
<h2 class="section-title mt-8">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</h2>
<form action="{{ url_for('add_order') }}" method="post" class="bg-white p-4 rounded shadow space-y-3">
  <input type="hidden" name="service_id" value="{{ service.id }}">
  <input type="hidden" name="user_id" value="1"> <!-- –ø–æ–∫–∞ –∂—ë—Å—Ç–∫–æ —Å—Ç–∞–≤–∏–º operator1 -->

  <div>
  <label class="block text-sm font-medium">–ü–æ–ª—É—á–∏–ª–∏</label>
  <select name="received_asset_id" class="border px-2 py-1 rounded">
    {% for asset in assets %}
      <option value="{{ asset.id }}">{{ asset.symbol }}</option>
    {% endfor %}
  </select>
  <input type="text" name="received_amount" placeholder="–°—É–º–º–∞" class="border px-2 py-1 rounded">
</div>

<div>
  <label class="block text-sm font-medium">–û—Ç–¥–∞–ª–∏</label>
  <select name="given_asset_id" class="border px-2 py-1 rounded">
    {% for asset in assets %}
      <option value="{{ asset.id }}">{{ asset.symbol }}</option>
    {% endfor %}
  </select>
  <input type="text" name="given_amount" placeholder="–°—É–º–º–∞" class="border px-2 py-1 rounded">
</div>

  <div>
    <label class="block text-sm font-medium">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
    <input type="text" name="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" class="border w-full px-2 py-1 rounded">
  </div>

  <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded">–î–æ–±–∞–≤–∏—Ç—å</button>
</form>


  </div>
</body>
</html>
